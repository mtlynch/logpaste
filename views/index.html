<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>{{.Title}}</title>
    <link rel="stylesheet" type="text/css" href="/css/style.css" />
  </head>
  <body>
    <div class="container">
      <h1>{{.Title}}</h1>

      <p class="subtitle">{{.Subtitle}}</p>

      {{ if .ShowDocs }}
      <div class="documentation">
        <h2>Upload from the command line</h2>
        <pre id="curl-cmd"></pre>
      </div>
      {{ end }}

      <h2>Upload via JavaScript</h2>

      <p>Instructions coming soon.</p>

      <div class="web-ui-upload">
        <h2>Upload via web UI</h2>

        <textarea id="upload-textarea"></textarea>

        <input type="submit" id="upload" value="Upload" />

        <p id="result">&nbsp;</p>
      </div>

      <div id="more-info">
        <h2>More info</h2>
        <p>
          <a href="https://github.com/mtlynch/logpaste"
            >github.com/mtlynch/logpaste</a
          >
        </p>
      </div>
    </div>

    <script src="/js/controllers.js"></script>
    <script>
      document.getElementById("curl-cmd").innerText = `
echo "some data I want to upload" | \\
  curl \\
    --silent \\
    --show-error \\
    --form 'logpaste=<-' \\
     ${document.location}`.trim();
      document.getElementById("upload").addEventListener("click", (evt) => {
        const textToUpload = document.getElementById("upload-textarea").value;
        controllers.uploadText(textToUpload).then((id) => {
          const resultUrl = `${document.location}${id}`;

          const paragraph = document.createElement("p");
          paragraph.innerText = resultUrl;

          const anchor = document.createElement("a");
          anchor.href = resultUrl;
          anchor.appendChild(paragraph);

          const resultDiv = document.getElementById("result");
          while (resultDiv.firstChild) {
            resultDiv.removeChild(resultDiv.lastChild);
          }
          resultDiv.appendChild(anchor);
        });
      });
    </script>
  </body>
</html>
